<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Cartographie régionale – Musiques actuelles (Hauts-de-France)</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <style>
    :root { --bg:#0b1220; --panel:#0f1b31; --text:#e8eefc; --muted:#a9b7d7; --border:rgba(255,255,255,.10); --chip:rgba(255,255,255,.06); }
    html, body { height:100%; margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; background:var(--bg); color:var(--text); }
    .layout { display:grid; grid-template-columns:360px 1fr; height:100%; }
    .sidebar { background:var(--panel); border-right:1px solid var(--border); padding:16px; overflow:auto; }
    #map { height:100%; }
    h1 { font-size:16px; margin:0 0 8px 0; }
    .sub { font-size:12px; color:var(--muted); margin-bottom:12px; line-height:1.3; }
    .section { border-top:1px solid var(--border); padding-top:12px; margin-top:12px; }
    .row { display:flex; gap:8px; align-items:center; }
    .pill { background:var(--chip); padding:6px 8px; border:1px solid var(--border); border-radius:999px; font-size:12px; color:var(--muted); }
    .search { width:100%; padding:10px 10px; border-radius:12px; border:1px solid var(--border); background:rgba(0,0,0,.15); color:var(--text); outline:none; }
    label { display:flex; align-items:center; gap:8px; padding:6px 0; color:var(--text); font-size:13px; }
    input[type="checkbox"] { width:16px; height:16px; }
    .legend { display:grid; gap:8px; }
    .lg { display:flex; align-items:center; gap:10px; font-size:12px; color:var(--muted); }
    .swatch { width:14px; height:14px; border-radius:4px; border:1px solid rgba(255,255,255,.25); }
    .btnbar { display:flex; gap:8px; margin-top:10px; }
    button { cursor:pointer; border:1px solid var(--border); background:rgba(255,255,255,.06); color:var(--text); padding:10px 10px; border-radius:12px; font-weight:600; }
    button:hover { background:rgba(255,255,255,.10); }
    .small { font-size:12px; color:var(--muted); }
    .foot { margin-top:10px; font-size:11px; color:var(--muted); line-height:1.3; }
    .badge { display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid var(--border); background:rgba(255,255,255,.06); font-size:11px; color:var(--muted); margin-right:6px; }
    a { color:#8ab4ff; text-decoration:none; }
    a:hover { text-decoration:underline; }
  </style>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <h1>Cartographie régionale – formations & ressources en musiques actuelles</h1>
      <div class="sub">
        Hauts-de-France • Carte interactive (Leaflet). Les points sont localisés au <b>centre de commune</b> via l’API Découpage administratif (geo.api.gouv.fr).
        <br/>Filtres = lecture pédagogique (compétences, modalités, type de structure).
      </div>

      <input id="q" class="search" placeholder="Rechercher (nom, ville, catégorie, métiers)…"/>

      <div class="section">
        <div class="row" style="justify-content:space-between;">
          <div class="pill" id="countPill">0 structures</div>
          <div class="pill" id="geoPill">Géocodage…</div>
        </div>
        <div class="btnbar">
          <button id="resetBtn" title="Réinitialiser filtres">Réinitialiser</button>
          <button id="fitBtn" title="Ajuster la vue">Voir tout</button>
        </div>
      </div>

      <div class="section">
        <b style="font-size:13px;">Filtres – modalités</b>
        <label><input type="checkbox" class="f" data-k="Initiale" checked/> Formation initiale</label>
        <label><input type="checkbox" class="f" data-k="Continue" checked/> Formation continue</label>
        <label><input type="checkbox" class="f" data-k="Stages" checked/> Stages courts</label>
        <label><input type="checkbox" class="f" data-k="Diplomante" checked/> Offre diplômante / certifiante</label>
        <label><input type="checkbox" class="f" data-k="SansDiplome" checked/> Sans offre diplômante (ressource / accompagnement)</label>
      </div>

      <div class="section">
        <b style="font-size:13px;">Filtres – compétences</b>
        <label><input type="checkbox" class="f" data-k="Artistique" checked/> Artistique</label>
        <label><input type="checkbox" class="f" data-k="Technique" checked/> Technique (son/MAO/live)</label>
        <label><input type="checkbox" class="f" data-k="AdminProd" checked/> Admin / production</label>
        <label><input type="checkbox" class="f" data-k="Audiovisuel" checked/> Audiovisuel</label>
        <label><input type="checkbox" class="f" data-k="Enseignement" checked/> Enseignement / pédagogie</label>
        <label><input type="checkbox" class="f" data-k="SantePrevention" checked/> Santé / prévention</label>
        <label><input type="checkbox" class="f" data-k="CentreRessources" checked/> Centre ressource</label>
      </div>

      <div class="section">
        <b style="font-size:13px;">Typologie</b>
        <label><input type="checkbox" class="t" data-k="ConservatoirePoleSup" checked/> Conservatoire / Pôle sup</label>
        <label><input type="checkbox" class="t" data-k="OFPrive" checked/> OF privé</label>
        <label><input type="checkbox" class="t" data-k="OFPublique" checked/> OF public</label>
        <label><input type="checkbox" class="t" data-k="Universite" checked/> Université</label>
        <label><input type="checkbox" class="t" data-k="Reseau" checked/> Réseau</label>
        <label><input type="checkbox" class="t" data-k="Divers" checked/> Divers</label>
      </div>

      <div class="section">
        <b style="font-size:13px;">Légende (couleur = logique dominante)</b>
        <div class="legend">
          <div class="lg"><span class="swatch" style="background:#F2C94C"></span> Institutionnel artistique</div>
          <div class="lg"><span class="swatch" style="background:#2D9CDB"></span> OF pro (insertion / métier)</div>
          <div class="lg"><span class="swatch" style="background:#27AE60"></span> Hybride / réseau (modularité)</div>
          <div class="lg"><span class="swatch" style="background:#9B51E0"></span> Ressource / accompagnement</div>
          <div class="lg"><span class="swatch" style="background:#828282"></span> Autre / non catégorisé</div>
        </div>
      </div>

      <div class="section">
        <b style="font-size:13px;">Astuce d’usage</b>
        <div class="small">Clique un point pour voir la fiche. Utilise “Voir tout” après un filtrage.</div>
        <div class="foot">
          Données : fichier Excel (59 entrées). Localisation : centre de commune via <a href="https://geo.api.gouv.fr/" target="_blank" rel="noreferrer">geo.api.gouv.fr</a>.
        </div>
      </div>
    </aside>

    <main id="map"></main>
  </div>

<script>
const DATA = [{"nom": "IFFMAA – Institut de Formation de la Filière des Musiques Actuelles", "adresse": "2 rue Lemoine", "cp": "59410", "ville": "Anzin", "telephone": "03 74 40 01 71", "site": "https://www.iffmaa.org", "email": "infos@iffmaa.org", "categorie": "Association / Organisme de formation", "types_formation": "Professionnelle (certifiante/qualifiante), continue, modules courts", "famille_metier": "Artistes musiques actuelles ; Technique live & studio ; Administration/Production", "diplomes": "Certificats internes ; catalogue Qualiopi", "modalites": "Présentiel (ateliers, plateaux techniques), parfois hybride", "rncp": 0, "afdas": 1, "type": "OF Privé", "Artistique": 0, "Technique": 1, "AdminProd": 1, "SantePrevention": 0, "Enseignement": 0, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 1, "Stages": 0, "Diplomante": 1, "SansDiplome": 0, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "EF2M – École de Formation aux Métiers de la Musique", "adresse": "12 bis rue du Moulin Tonton", "cp": "59200", "ville": "Tourcoing", "telephone": "03 20 26 46 47", "site": "https://ef2m.com", "email": "contact@ef2m.com", "categorie": "Organisme de formation (privé)", "types_formation": "Professionnelle certifiante, continue", "famille_metier": "Artiste musiques actuelles ; MAO ; Techniques du son ; Production", "diplomes": "AMMA (FNEIJMA) – niveau 5", "modalites": "Présentiel (studios, scène), ateliers/pratiques collectives", "rncp": 1, "afdas": 1, "type": "OF Privé", "Artistique": 1, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 1, "Stages": 0, "Diplomante": 1, "SansDiplome": 0, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "CFPM Lille–Tourcoing", "adresse": "9 rue de Toulon", "cp": "59200", "ville": "Tourcoing", "telephone": "09 72 23 36 72", "site": "https://www.cfpmfrance.com/cfpm-lille", "email": "lille@cfpmfrance.com", "categorie": "Réseau d'écoles / Organisme de formation", "types_formation": "Professionnelle (cursus, stages), continue", "famille_metier": "Musicien, MAO, Musiques électroniques, Technicien du son/spectacle", "diplomes": "Certifications inscrites (ex: blocs RNCP/RS)", "modalites": "Présentiel (studios pro)", "rncp": 1, "afdas": 1, "type": "Réseau", "Artistique": 0, "Technique": 1, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 0, "Stages": 1, "Diplomante": 1, "SansDiplome": 0, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 1, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "CRR de Lille (Faubourg des Musiques – techniques vocales MA)", "adresse": "Rue Alphonse Colas", "cp": "59000", "ville": "Lille", "telephone": "03 28 38 77 50", "site": "https://conservatoire.lille.fr", "email": "nan", "categorie": "Conservatoire (CRR)", "types_formation": "Initiale (cycles), ateliers, jazz & musiques actuelles", "famille_metier": "Chant/techniques vocales musiques actuelles ; instruments ; jazz", "diplomes": "DEM, CEPI (diplômes d’établissement)", "modalites": "Présentiel", "rncp": 1, "afdas": 0, "type": "Conservatoire/Pôle Sup", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 1, "Diplomante": 1, "SansDiplome": 0, "Universite": 0, "ConservatoirePoleSup": 1, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "ESMD – École Supérieure Musique et Danse Hauts-de-France (DNSPM / DE) – partenariat Université de Lille", "adresse": "Rue Alphonse Colas", "cp": "59000", "ville": "Lille", "telephone": "03 28 36 67 90", "site": "https://www.esmd.fr/musique/diplome-national-superieur-professionnel-de-musicien/", "email": "info@esmd.fr", "categorie": "Pôle supérieur (Ministère Culture) en partenariat universitaire", "types_formation": "DNSPM (instrumentiste/chanteur ; chef d’ensemble) ; préparation/formation DE musique", "famille_metier": "Interprète ; Chef·fe d’ensemble ; Enseignant·e artistique (DE)", "diplomes": "DNSPM (niveau 6) ; Diplôme d’État de professeur de musique (niveau 6)", "modalites": "Initiale ; formation continue ; VAE (DE) ; possibles parcours en apprentissage selon années", "rncp": 1, "afdas": 1, "type": "Université", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 0, "Stages": 0, "Diplomante": 1, "SansDiplome": 0, "Universite": 1, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "Sciences Po Lille – Parcours Management des Institutions Culturelles (MIC)", "adresse": "9 rue Angellier", "cp": "59000", "ville": "Lille", "telephone": "03 20 90 48 40", "site": "https://mic.sciencespo-lille.eu/", "email": "contact@sciencespo-lille.eu", "categorie": "Grande école (parcours de master – diplôme d’établissement)", "types_formation": "Initiale, Continue (selon dispositifs)", "famille_metier": "Management des institutions culturelles, politiques culturelles", "diplomes": "Diplôme de Sciences Po Lille (grade master) – hors RNCP spécifique", "modalites": "Parcours MIC au sein du cursus; interventions pros, projets, stages", "rncp": 0, "afdas": 1, "type": "OF Privé", "Artistique": 0, "Technique": 0, "AdminProd": 1, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 1, "Stages": 0, "Diplomante": 1, "SansDiplome": 0, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "Université Catholique de Lille (FLSH) – Master Cultural Management (diplôme d’établissement)", "adresse": "FLSH, 60 boulevard Vauban – CS 40109", "cp": "59016", "ville": "Lille", "telephone": "03 20 13 40 50", "site": "https://www.flsh-lille.com/programs/masters-degrees/cultural-management/", "email": "flsh@univ-catholille.fr", "categorie": "Université privée (Master – diplôme d’établissement)", "types_formation": "Initiale, Continue", "famille_metier": "Management culturel, cinéma, musiques contemporaines (contenus dédiés)", "diplomes": "Master d’établissement (hors RNCP)", "modalites": "Cours + séminaires pros; spécialités cinéma et musiques contemporaines", "rncp": 0, "afdas": 1, "type": "Université", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 0, "Stages": 0, "Diplomante": 1, "SansDiplome": 0, "Universite": 1, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Autre", "couleur": "#828282"}, {"nom": "CRR d’Amiens Métropole – Département Jazz & Musiques actuelles amplifiées", "adresse": "3 rue Desprez", "cp": "80000", "ville": "Amiens", "telephone": "03 22 91 57 83", "site": "https://www.amiens.fr/Le-Conservatoire-CRR", "email": "crr@amiens-metropole.com", "categorie": "Conservatoire (CRR)", "types_formation": "Initiale (cycles), CEPI ; jazz & musiques actuelles amplifiées", "famille_metier": "Jazz ; musiques actuelles amplifiées (ateliers, ensembles)", "diplomes": "DEM, CEPI (diplômes d’établissement)", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "Conservatoire/Pôle Sup", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 0, "Diplomante": 1, "SansDiplome": 0, "Universite": 0, "ConservatoirePoleSup": 1, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "INSPÉ de l’Académie d’Amiens (UPJV) – Centres Amiens/Beauvais/Laon", "adresse": "Citadelle – 10 rue des Français Libres (Centre Amiens)", "cp": "80080", "ville": "Amiens", "telephone": "03 64 26 84 40", "site": "https://inspe.u-picardie.fr/contactez-linspe", "email": "inspe-contact@u-picardie.fr", "categorie": "INSPÉ (Université)", "types_formation": "Masters MEEF (1er/2d degré) avec UE/enseignements artistiques selon mentions ; préparation concours", "famille_metier": "Enseignant·e (éducation musicale au 2d degré selon mentions académiques)", "diplomes": "Masters MEEF (bac+5)", "modalites": "Initiale ; alternance ; formation continue", "rncp": 0, "afdas": 1, "type": "Université", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 0, "Diplomante": 1, "SansDiplome": 0, "Universite": 1, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Autre", "couleur": "#828282"}, {"nom": "UPJV – UFR des Arts (Licence pro Techniques du son et de l’image ; arts du spectacle/cinéma)", "adresse": "La Teinturerie, 30 rue des Teinturiers", "cp": "80080", "ville": "Amiens", "telephone": "03 22 22 43 43", "site": "https://www.u-picardie.fr/formation/catalogue/licence-professionnelle-techniques-son-limage-metiers-post-production-image-son", "email": "infos-arts@u-picardie.fr", "categorie": "Université (UFR des Arts)", "types_formation": "LP Techniques du son et de l’image (postproduction) ; Licences/Masters arts du spectacle/cinéma", "famille_metier": "Métiers du son/audiovisuel ; production/postproduction ; culture", "diplomes": "Licence professionnelle (bac+3) ; Licences ; Masters", "modalites": "Initiale ; alternance possible selon maquettes ; formation continue", "rncp": 1, "afdas": 1, "type": "Université", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 1, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 0, "Diplomante": 1, "SansDiplome": 0, "Universite": 1, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Autre", "couleur": "#828282"}, {"nom": "CRD de Tourcoing", "adresse": "nan", "cp": "59200", "ville": "Tourcoing", "telephone": "nan", "site": "https://www.tourcoing.fr/Des-idees-d-activite/Culture/Musique/Le-Conservatoire-a-Rayonnement-Departemental-de-Tourcoing", "email": "nan", "categorie": "Conservatoire (CRD)", "types_formation": "Initiale (cycles), CPES via réseau LRT", "famille_metier": "Jazz et musiques improvisées ; ensembles musiques actuelles", "diplomes": "Diplômes d’établissement", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "Conservatoire/Pôle Sup", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 0, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 1, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "CRD de Roubaix", "adresse": "nan", "cp": "59100", "ville": "Roubaix", "telephone": "nan", "site": "https://www.ville-roubaix.fr/services-infos-pratiques/culture-et-patrimoine/conservatoire-de-roubaix/", "email": "nan", "categorie": "Conservatoire (CRD)", "types_formation": "Initiale (cycles), CPES (via réseau LRT)", "famille_metier": "Parcours jazz ; pratiques collectives ; préparation supérieure", "diplomes": "Diplômes d’établissement", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "Conservatoire/Pôle Sup", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 0, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 1, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "Le Flow – Centre Eurorégional des Cultures Urbaines", "adresse": "1 rue de Fontenoy", "cp": "59000", "ville": "Lille", "telephone": "03 62 14 59 52", "site": "https://flow.lille.fr/le-flow", "email": "nan", "categorie": "Équipement culturel – centre de ressources / formation", "types_formation": "Workshops, masterclasses, coaching, professionnalisation", "famille_metier": "Artistes hip-hop (rap, DJing, beatbox), techniciens, production", "diplomes": "Ateliers / modules ; pas de diplôme d’État", "modalites": "Présentiel (studios musique & danse)", "rncp": 1, "afdas": 1, "type": "OF Privé", "Artistique": 1, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 0, "Audiovisuel": 0, "CentreRessources": 1, "Initiale": 0, "Continue": 0, "Stages": 1, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "Studios On Air (école des arts du spectacle)", "adresse": "33 rue Michel Raillard", "cp": "59420", "ville": "Mouvaux", "telephone": "03 20 17 11 37", "site": "https://studiosonair.com", "email": "nan", "categorie": "École privée / Organisme de formation (Qualiopi)", "types_formation": "Cours réguliers, stages, formations pro, coaching scénique", "famille_metier": "Chant ; danse ; théâtre ; coaching scénique (pratiques MA)", "diplomes": "Formations internes (Qualiopi)", "modalites": "Présentiel (studios)", "rncp": 1, "afdas": 1, "type": "OF Privé", "Artistique": 1, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 1, "Stages": 1, "Diplomante": 1, "SansDiplome": 0, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "Drumlive Academy (école de batterie)", "adresse": "19 rue de Toulon", "cp": "59200", "ville": "Tourcoing", "telephone": "06 32 39 52 44", "site": "https://drumliveacademy.com", "email": "maxdrum@hotmail.fr", "categorie": "École spécialisée / indépendant", "types_formation": "Cours individuels, stages (Drum Camps), VOD", "famille_metier": "Instrumentiste – batteur (musiques actuelles, live)", "diplomes": "Formations internes", "modalites": "Présentiel & distanciel (VOD)", "rncp": 1, "afdas": 1, "type": "OF Privé", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 0, "Stages": 1, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "Rock in Progress", "adresse": "Rue de la Mairie", "cp": "59164", "ville": "Marpent", "telephone": "06 70 94 35 83", "site": "https://rockinprogress.fr", "email": "contact@rockinprogress.fr", "categorie": "Association / École & studio", "types_formation": "Cours, accompagnement d’artistes, ateliers, répétitions", "famille_metier": "Artistes-interprètes ; MAO ; accompagnement scénique", "diplomes": "Formations internes", "modalites": "Présentiel (studio / répétition)", "rncp": 1, "afdas": 1, "type": "Réseau", "Artistique": 1, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 0, "Stages": 1, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 1, "famille": "Autre", "couleur": "#828282"}, {"nom": "Conservatoire de Dunkerque (département MA & jazz)", "adresse": "nan", "cp": "59140", "ville": "Dunkerque", "telephone": "nan", "site": "https://www.ville-dunkerque.fr/decouvrir-sortir-bouger/culture/conservatoire/je-minscris-au-conservatoire", "email": "nan", "categorie": "Conservatoire (CRD)", "types_formation": "Initiale (cycles) ; ateliers MA et jazz", "famille_metier": "Chant/guitare/basse/batterie MA ; jazz", "diplomes": "Diplômes d’établissement", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "Conservatoire/Pôle Sup", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 1, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 1, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "Conservatoire du Beauvaisis (ateliers musiques actuelles)", "adresse": "36 rue de Buzanval", "cp": "60000", "ville": "Beauvais", "telephone": "03 44 15 67 04", "site": "https://conservatoire.beauvaisis.fr/", "email": "conservatoire@beauvaisis.fr", "categorie": "Conservatoire (CRC/CRD)", "types_formation": "Initiale (cycles) ; ateliers musiques actuelles", "famille_metier": "Chorale musiques actuelles ; ateliers MA", "diplomes": "Diplômes d’établissement", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "Conservatoire/Pôle Sup", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 1, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 1, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "APSArts", "adresse": "9-11 rue de la gare", "cp": "59280", "ville": "Armentières", "telephone": "06 63 60 70 97", "site": "https://apsarts.fr", "email": "stephane.quoniam@apsarts.fr", "categorie": "Association", "types_formation": "Formation Continue", "famille_metier": "Santé/Prévention", "diplomes": "nan", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "OF Privé", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 1, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 1, "Stages": 0, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "Spiritek", "adresse": "49 rue du Molinel", "cp": "59000", "ville": "Lille", "telephone": "nan", "site": "https://www.spiritek-asso.com", "email": "contact@spiritek-asso.com", "categorie": "Association", "types_formation": "nan", "famille_metier": "Santé/Prévention", "diplomes": "nan", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "OF Privé", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 1, "Enseignement": 0, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 1, "Stages": 0, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "Vibrazzio Coaching", "adresse": "nan", "cp": "59000", "ville": "Lille", "telephone": "06 76 98 90 73", "site": "https://vibrazzio-coaching.com/", "email": "elodie@vibrazzio-coaching.com", "categorie": "Association", "types_formation": "nan", "famille_metier": "Coaching", "diplomes": "nan", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "OF Privé", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 0, "Audiovisuel": 0, "CentreRessources": 1, "Initiale": 0, "Continue": 1, "Stages": 0, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "AMC", "adresse": "43ter avenue Raymond Poincaré", "cp": "60280", "ville": "Margny-lès-Compiegne", "telephone": "06 03 25 13 39", "site": "https://www.ecole-amc.com/", "email": "ecole-amc@orange.fr", "categorie": "École", "types_formation": "Formation Continue", "famille_metier": "Formation", "diplomes": "nan", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "OF Privé", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 1, "Stages": 0, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "Alive School", "adresse": "119 chaussée Marcelin Berthelot", "cp": "59200", "ville": "Tourcoing", "telephone": "03 20 11 23 08", "site": "nan", "email": "contact@alive-school.fr", "categorie": "Association", "types_formation": "Formation Continue", "famille_metier": "Formation", "diplomes": "nan", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "OF Privé", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 1, "Stages": 0, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "Prolive Formation", "adresse": "Rue Michel Rondet", "cp": "59130", "ville": "Wallers", "telephone": "03 59 05 54 34", "site": "https://www.proliveformation.fr/", "email": "nan", "categorie": "Structure privée", "types_formation": "Formation Initiale et Continue", "famille_metier": "Formation", "diplomes": "nan", "modalites": "Présentiel", "rncp": 0, "afdas": 1, "type": "OF Privé", "Artistique": 0, "Technique": 1, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 1, "Stages": 0, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "Milac", "adresse": "21 rue de Pologne", "cp": "59800", "ville": "Lille", "telephone": "03 20 31 52 01", "site": "https://milac.fr/musique-lille/", "email": "nan", "categorie": "École", "types_formation": "Formation Continue", "famille_metier": "Formation", "diplomes": "nan", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "OF Privé", "Artistique": 1, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 1, "Stages": 0, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "Lieu Musical Expérimental", "adresse": "Rue de la Haye", "cp": "59760", "ville": "Grande-Synthe", "telephone": "03 28 24 49 22", "site": "https://www.ville-grande-synthe.fr", "email": "nan", "categorie": "École", "types_formation": "Formation Continue", "famille_metier": "Artistique", "diplomes": "nan", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "OF Privé", "Artistique": 1, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 1, "Stages": 0, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "Autour des Rythmes Actuels (ARA)", "adresse": "301 Avenue Nations Unies", "cp": "59100", "ville": "Roubaix", "telephone": "03 20 28 06 50", "site": "https://www.ara-asso.fr", "email": "info@ara-asso.fr", "categorie": "Association", "types_formation": "nan", "famille_metier": "nan", "diplomes": "nan", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "OF Privé", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 0, "Audiovisuel": 0, "CentreRessources": 1, "Initiale": 0, "Continue": 1, "Stages": 0, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "Conservatoire de Valenciennes Eugène Bozza", "adresse": "82 Rue Ferrand", "cp": "59300", "ville": "Valenciennes", "telephone": "nan", "site": "nan", "email": "nan", "categorie": "Conservatoire (CRD)", "types_formation": "Initiale (cycles), ateliers MA/Jazz", "famille_metier": "Instrument/Chant MA ; Jazz", "diplomes": "Diplômes d’établissement", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "Conservatoire/Pôle Sup", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 0, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 1, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "Université Polytechnique Hauts-de-France (UPHF) – Master Audiovisuel, Médias Interactifs Numériques, Jeux", "adresse": "Le Mont Houy", "cp": "59313", "ville": "Valenciennes", "telephone": "nan", "site": "https://formations.uphf.fr/fr/formations/master-master/master-audiovisuel-medias-interactifs-numeriques-jeux-KYYP81HT.html", "email": "—", "categorie": "Université (INSA Hauts-de-France / UPHF)", "types_formation": "Master AMINJ – parcours Ingénierie des systèmes images et sons ; Productions ; Postproduction", "famille_metier": "Ingénierie du son, audiovisuel, production/postproduction, médias numériques", "diplomes": "Master (bac+5)", "modalites": "Initiale ; apprentissage selon années ; FC", "rncp": 1, "afdas": 1, "type": "Université", "Artistique": 0, "Technique": 1, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 0, "Stages": 0, "Diplomante": 1, "SansDiplome": 0, "Universite": 1, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Autre", "couleur": "#828282"}, {"nom": "INSPÉ de l’Académie de Lille – MEEF (éducation musicale/arts)", "adresse": "Campus Flers Château, 365 bis rue Jules Guesde", "cp": "59650", "ville": "Villeneuve-d'Ascq", "telephone": "nan", "site": "https://www.inspe-lille-hdf.fr/plan-et-contact", "email": "arts-master-meef@univ-lille.fr", "categorie": "INSPÉ (Université)", "types_formation": "Master MEEF – mentions (dont arts/éducation musicale selon maquettes), préparation concours", "famille_metier": "Enseignant·e éducation musicale/arts", "diplomes": "Master (bac+5) ; concours de l’Éducation nationale", "modalites": "Initiale ; alternance selon maquettes ; formation continue", "rncp": 0, "afdas": 1, "type": "Université", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 0, "Stages": 0, "Diplomante": 1, "SansDiplome": 0, "Universite": 1, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Autre", "couleur": "#828282"}, {"nom": "Université de Lille × ESMD – Licence Arts (parcours Formation du musicien interprète et créateur) adossée au DNSPM ESMD", "adresse": "Campus Pont-de-Bois, Rue du Barreau", "cp": "59653", "ville": "Villeneuve-d'Ascq", "telephone": "nan", "site": "https://www.univ-lille.fr/formations/fr-00057622", "email": "—", "categorie": "Partenariat Université–Pôle supérieur", "types_formation": "Double cursus Licence Arts (Univ. Lille) + DNSPM (ESMD)", "famille_metier": "Musicien·ne interprète (musiques classiques et actuelles), création", "diplomes": "Licence (bac+3) + DNSPM (niveau 6)", "modalites": "Formation initiale ; possibilité de VAE (DE) à l’ESMD", "rncp": 1, "afdas": 1, "type": "Université", "Artistique": 1, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 0, "Stages": 0, "Diplomante": 1, "SansDiplome": 0, "Universite": 1, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "Université de Lille – CFMI (Centre de formation de musiciens intervenants) – DUMI", "adresse": "3 rue du Barreau, Domaine universitaire du Pont de Bois – BP 60149", "cp": "59653", "ville": "Villeneuve-d'Ascq", "telephone": "03 20 41 73 11", "site": "https://cfmi.univ-lille.fr/contacts", "email": "—", "categorie": "CFMI (Université)", "types_formation": "DUMI – Diplôme Universitaire de Musicien Intervenant", "famille_metier": "Musicien·ne intervenant·e (EAC, milieu scolaire et territorial)", "diplomes": "DUMI (niveau 6)", "modalites": "Initiale et continue ; stages ; VAE selon centres", "rncp": 1, "afdas": 1, "type": "Université", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 0, "Diplomante": 1, "SansDiplome": 0, "Universite": 1, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Autre", "couleur": "#828282"}, {"nom": "Université de Lille – Licence Arts (parcours Musique et musicologie) – Département Arts", "adresse": "Campus Pont-de-Bois, Rue du Barreau", "cp": "59653", "ville": "Villeneuve-d'Ascq", "telephone": "03 20 41 63 25", "site": "https://www.univ-lille.fr/formations/fr-00002588", "email": "arts-musique-danse@univ-lille.fr", "categorie": "Université (UFR Humanités – Département Arts)", "types_formation": "Licence Arts – parcours Musique et musicologie (options musiques actuelles selon maquettes)", "famille_metier": "Interprète, créateur·rice, médiation culturelle, production musicale, enseignement (poursuite)", "diplomes": "Licence (bac+3)", "modalites": "Initiale ; reprise d’études/FC ; VAE/VAPP selon cas", "rncp": 0, "afdas": 1, "type": "Université", "Artistique": 1, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 0, "Diplomante": 1, "SansDiplome": 0, "Universite": 1, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Autre", "couleur": "#828282"}, {"nom": "Université de Lille – Master Culture et communication (parcours Métiers de la culture, médiation, numérique)", "adresse": "FASEST – Campus Cité scientifique, Bât. SH2, 59650 Villeneuve-d’Ascq", "cp": "59650", "ville": "Villeneuve-d'Ascq / Lille", "telephone": "03 20 41 60 25", "site": "https://fasest.univ-lille.fr/formations/catalogue-des-formations/fiche/fr-00001920", "email": "master-culture@univ-lille.fr", "categorie": "Université (Master)", "types_formation": "Initiale, Continue, Alternance (selon années/parcours)", "famille_metier": "Gestion/coordination de projets culturels, médiation, ICC, culture numérique", "diplomes": "Master (Niveau 7) mention Culture et communication", "modalites": "Cours + projets + stage", "rncp": 1, "afdas": 1, "type": "Université", "Artistique": 0, "Technique": 0, "AdminProd": 1, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 0, "Diplomante": 1, "SansDiplome": 0, "Universite": 1, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Autre", "couleur": "#828282"}, {"nom": "CFMI – Université de Lille (musicien intervenant)", "adresse": "Pont de Bois, Campus", "cp": "59653", "ville": "Villeneuve-d'Ascq", "telephone": "nan", "site": "https://cfmi.univ-lille.fr/formations", "email": "nan", "categorie": "Établissement d’enseignement supérieur", "types_formation": "Initiale (L3/DU) & Formation continue", "famille_metier": "Pédagogie musicale ; intervenant·e en milieu scolaire/culturel", "diplomes": "Diplômes universitaires", "modalites": "Présentiel", "rncp": 0, "afdas": 1, "type": "Université", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 0, "Diplomante": 1, "SansDiplome": 0, "Universite": 1, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Autre", "couleur": "#828282"}, {"nom": "Conservatoire municipal de Senlis", "adresse": "nan", "cp": "60300", "ville": "Senlis", "telephone": "nan", "site": "nan", "email": "nan", "categorie": "Conservatoire (CRC)", "types_formation": "Initiale (cycles), ateliers", "famille_metier": "Pratiques collectives ; MA selon offre locale", "diplomes": "Diplômes d’établissement", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "Conservatoire/Pôle Sup", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 1, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 1, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "Conservatoire de la Baie de Somme", "adresse": "nan", "cp": "80100", "ville": "Abbeville", "telephone": "nan", "site": "nan", "email": "nan", "categorie": "Conservatoire (CRI/CRC)", "types_formation": "Initiale (cycles), ateliers", "famille_metier": "Pratiques collectives ; MA selon offre locale", "diplomes": "Diplômes d’établissement", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "Conservatoire/Pôle Sup", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 1, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 1, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "Cité Carter", "adresse": "Bd de Châteaudun", "cp": "80000", "ville": "Amiens", "telephone": "nan", "site": "nan", "email": "nan", "categorie": "Association / Lieu ressource", "types_formation": "Apprentissage/Enseignement (ateliers) ; accompagnement", "famille_metier": "Coaching artiste ; MAO ; pratiques collectives", "diplomes": "Formations internes", "modalites": "Présentiel", "rncp": 0, "afdas": 1, "type": "OF Privé", "Artistique": 1, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 1, "Stages": 1, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "CRC de Laon", "adresse": "nan", "cp": "02000", "ville": "Laon", "telephone": "nan", "site": "nan", "email": "nan", "categorie": "Conservatoire (CRC)", "types_formation": "Initiale (cycles), ateliers", "famille_metier": "Pratiques collectives ; MA selon offre locale", "diplomes": "Diplômes d’établissement", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "Conservatoire/Pôle Sup", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 1, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 1, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "Conservatoire Municipal de Musique de Tergnier", "adresse": "nan", "cp": "02700", "ville": "Tergnier", "telephone": "nan", "site": "nan", "email": "nan", "categorie": "Conservatoire (CRC)", "types_formation": "Initiale (cycles), ateliers", "famille_metier": "Pratiques collectives ; MA selon offre locale", "diplomes": "Diplômes d’établissement", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "Conservatoire/Pôle Sup", "Artistique": 1, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 1, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 1, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "Conservatoire de Soissons", "adresse": "nan", "cp": "02200", "ville": "Soissons", "telephone": "nan", "site": "nan", "email": "nan", "categorie": "Conservatoire (CRC/CRD)", "types_formation": "Initiale (cycles), ateliers", "famille_metier": "Pratiques collectives ; MA selon offre locale", "diplomes": "Diplômes d’établissement", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "Conservatoire/Pôle Sup", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 1, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 1, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "Conservatoire de Saint-Quentin", "adresse": "nan", "cp": "02100", "ville": "Saint-Quentin", "telephone": "nan", "site": "nan", "email": "nan", "categorie": "Conservatoire (CRD)", "types_formation": "Initiale (cycles), ateliers", "famille_metier": "Pratiques collectives ; MA selon offre locale", "diplomes": "Diplômes d’établissement", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "Conservatoire/Pôle Sup", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 1, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 1, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "Space Caravan", "adresse": "nan", "cp": "02000", "ville": "Laon", "telephone": "nan", "site": "https://music-hdf.org", "email": "nan", "categorie": "Association", "types_formation": "Ateliers / Apprentissage", "famille_metier": "Accompagnement / MA", "diplomes": "nan", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "OF Privé", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 1, "Stages": 1, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "Les Caves à Musique", "adresse": "Place Victor Hugo", "cp": "02500", "ville": "Hirson", "telephone": "nan", "site": "https://www.cavesamusique.com", "email": "contact@cavesamusique.com", "categorie": "Lieu ressource / Association", "types_formation": "Apprentissage / Enseignement ; Ateliers", "famille_metier": "Accompagnement / Dév. ; MAO", "diplomes": "nan", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "OF Privé", "Artistique": 1, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 1, "Stages": 1, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "ASCA – L’Ouvre-Boîte", "adresse": "8 avenue de Bourgogne", "cp": "60000", "ville": "Beauvais", "telephone": "03 44 10 30 80", "site": "https://www.asca-asso.com", "email": "contact@asca-asso.com", "categorie": "Association / Centre culturel", "types_formation": "Ateliers / Formations / Masterclasses", "famille_metier": "Accompagnement ; pratiques MA", "diplomes": "nan", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "OF Privé", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 1, "Stages": 1, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "La Couveuse (Beauvais)", "adresse": "nan", "cp": "60000", "ville": "Beauvais", "telephone": "nan", "site": "https://www.lacouveuse.net", "email": "nan", "categorie": "Association", "types_formation": "Formation / Coaching ; Ateliers", "famille_metier": "Accompagnement ; Edition / droits", "diplomes": "nan", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "OF Privé", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 1, "Stages": 1, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "Campus des Musiques Actuelles (CMA)", "adresse": "2 rue Lemoine", "cp": "59410", "ville": "Anzin", "telephone": "03 74 40 01 70", "site": "https://campusma.org", "email": "nan", "categorie": "Équipement / centre de ressources", "types_formation": "Apprentissage / Enseignement ; Formation", "famille_metier": "Tech son ; prod ; MA ; artistes", "diplomes": "nan", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "OF Privé", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 1, "Initiale": 0, "Continue": 1, "Stages": 0, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "Musique en Herbe", "adresse": "nan", "cp": "80000", "ville": "Amiens", "telephone": "nan", "site": "https://music-hdf.org", "email": "nan", "categorie": "Association", "types_formation": "Apprentissage / Enseignement", "famille_metier": "Pratiques collectives ; ateliers MA", "diplomes": "nan", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "OF Privé", "Artistique": 1, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 1, "Stages": 0, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "UPJV – Master Sciences sociales – Parcours Culture, Patrimoines et Innovations Numériques (CPIN)", "adresse": "UFR SHSP – Pôle Citadelle, 10 rue des Français Libres", "cp": "80080", "ville": "Amiens", "telephone": "03 22 82 72 72", "site": "https://www.u-picardie.fr/catalogue-formations/FI/co/master-sc-cpin.html", "email": "ufr-shsp@u-picardie.fr", "categorie": "Université (Master)", "types_formation": "Initiale, Continue, Alternance (selon maquettes)", "famille_metier": "Ingénierie et médiation de projets culturels et patrimoniaux, innovation numérique", "diplomes": "Master (Niveau 7) mention Sciences sociales", "modalites": "Cours, projets avec professionnels, options innovations numériques", "rncp": 1, "afdas": 1, "type": "Université", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 0, "Stages": 0, "Diplomante": 1, "SansDiplome": 0, "Universite": 1, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Autre", "couleur": "#828282"}, {"nom": "Studio Youts", "adresse": "nan", "cp": "62126", "ville": "Wimille", "telephone": "nan", "site": "https://music-hdf.org", "email": "nan", "categorie": "Studio / Association", "types_formation": "Apprentissage / Enseignement (stages/coaching)", "famille_metier": "Enregistrement ; MAO ; coaching", "diplomes": "nan", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "OF Privé", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 1, "Stages": 1, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 1, "OFPublique": 0, "Divers": 0, "famille": "OF pro", "couleur": "#2D9CDB"}, {"nom": "Conservatoire du Boulonnais (CRD)", "adresse": "47 rue des Pipots", "cp": "62200", "ville": "Boulogne-sur-Mer", "telephone": "03 21 99 91 20", "site": "https://conservatoire.agglo-boulonnais.fr/enseignements/musique/musique-actuelle-jazz", "email": "nan", "categorie": "Conservatoire (CRD)", "types_formation": "Initiale (cycles) ; département Musiques actuelles / Jazz", "famille_metier": "Artiste-interprète ; pratiques collectives ; MA ; Jazz", "diplomes": "Diplômes d’établissement (DEM/CEPI)", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "Conservatoire/Pôle Sup", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 0, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 1, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "Conservatoire du Calaisis (CRD)", "adresse": "3 Rue du Pont Lottin", "cp": "62100", "ville": "Calais", "telephone": "03 21 46 62 60", "site": "https://www.conservatoire-calaisis.fr/", "email": "nan", "categorie": "Conservatoire (CRD)", "types_formation": "Initiale (cycles) ; département Musiques actuelles / Jazz", "famille_metier": "Pratiques collectives MA ; ateliers ; Jazz", "diplomes": "Diplômes d’établissement (DEM/CEPI)", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "Conservatoire/Pôle Sup", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 0, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 1, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "Conservatoire à Rayonnement Départemental d’Arras (CRD)", "adresse": "27 bis rue du Général Barbot", "cp": "62000", "ville": "Arras", "telephone": "nan", "site": "https://www.arras.fr/page/le-conservatoire", "email": "nan", "categorie": "Conservatoire (CRD)", "types_formation": "Initiale (cycles) ; département musiques actuelles (CRD 62)", "famille_metier": "Pratiques collectives ; CEPI", "diplomes": "Diplômes d’établissement (DEM/CEPI)", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "Conservatoire/Pôle Sup", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 0, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 1, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "Université d’Artois – UFR Lettres & Arts (Arts du spectacle / Cinéma – formations connexes)", "adresse": "9 rue du Temple – BP 10665", "cp": "62030", "ville": "Arras", "telephone": "03 21 60 37 00", "site": "https://www.univ-artois.fr/contacts", "email": "direction.etudes@univ-artois.fr", "categorie": "Université (UFR Lettres & Arts)", "types_formation": "Licences/Masters en Arts (arts du spectacle, cinéma) – champs connexes aux musiques actuelles (production, médiation, technique)", "famille_metier": "Médiation/production culturelle, ingénierie de projet, audiovisuel", "diplomes": "Licences / Masters", "modalites": "Initiale ; formation continue ; VAE/VAPP selon dispositifs U. d’Artois", "rncp": 0, "afdas": 1, "type": "Université", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 0, "Stages": 0, "Diplomante": 1, "SansDiplome": 0, "Universite": 1, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Autre", "couleur": "#828282"}, {"nom": "Université d’Artois – Master Histoire, civilisations, patrimoine – Parcours Gestion du patrimoine culturel", "adresse": "UFR Lettres & Arts, 9 rue du Temple – BP 10665", "cp": "62030", "ville": "Arras", "telephone": "03 21 60 37 25", "site": "https://formations.univ-artois.fr/fr/formations/feuilleter-le-catalogue/master-lmd-XB/master-histoire-civilisations-patrimoine-gestion-du-patrimoine-culturel-LJ6XANGZ.html", "email": "lettres@univ-artois.fr", "categorie": "Université (Master)", "types_formation": "Initiale, Continue, Alternance (selon parcours)", "famille_metier": "Gestion/valorisation patrimoniale, médiation, projets culturels", "diplomes": "Master (Niveau 7) mention Histoire, civilisations, patrimoine", "modalites": "Projets, visites pro, stages; capacité d’accueil limitée", "rncp": 1, "afdas": 1, "type": "Université", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 0, "Stages": 0, "Diplomante": 1, "SansDiplome": 0, "Universite": 1, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Autre", "couleur": "#828282"}, {"nom": "Conservatoire de Cambrai (CRD) – CFMA", "adresse": "Place Jean Moulin", "cp": "59400", "ville": "Cambrai", "telephone": "03 27 81 29 90", "site": "https://www.agglo-cambrai.fr/nos-structures/conservatoire-a-rayonnement-departemental-de-musique-et-de-theatre/musique", "email": "conservatoire@agglo-cambrai.fr", "categorie": "Conservatoire (CRD)", "types_formation": "Initiale (cycles) ; Pôle Musiques actuelles (CFMA)", "famille_metier": "MA : clavier ; guitare ; basse ; batterie ; chant ; MAO", "diplomes": "Diplômes d’établissement", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "Conservatoire/Pôle Sup", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 0, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 1, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "Conservatoire Frédéric-Chopin – Lens (CRC)", "adresse": "55 rue Romuald Pruvost", "cp": "62300", "ville": "Lens", "telephone": "03 21 69 86 10", "site": "https://villedelens.fr/mes-activit%C3%A9s/culture/le-conservatoire/", "email": "nan", "categorie": "Conservatoire (CRC)", "types_formation": "Initiale (cycles) ; pratiques collectives ; MAA selon parcours", "famille_metier": "Pratiques collectives ; ateliers ; CHAM", "diplomes": "Diplômes d’établissement", "modalites": "Présentiel", "rncp": 0, "afdas": 0, "type": "Conservatoire/Pôle Sup", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 1, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 1, "Continue": 0, "Stages": 0, "Diplomante": 0, "SansDiplome": 1, "Universite": 0, "ConservatoirePoleSup": 1, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}, {"nom": "nan", "adresse": "nan", "cp": "", "ville": "", "telephone": "nan", "site": "nan", "email": "nan", "categorie": "nan", "types_formation": "nan", "famille_metier": "nan", "diplomes": "nan", "modalites": "nan", "rncp": 0, "afdas": 0, "type": "nan", "Artistique": 0, "Technique": 0, "AdminProd": 0, "SantePrevention": 0, "Enseignement": 0, "Audiovisuel": 0, "CentreRessources": 0, "Initiale": 0, "Continue": 0, "Stages": 0, "Diplomante": 0, "SansDiplome": 0, "Universite": 0, "ConservatoirePoleSup": 0, "Reseau": 0, "OFPrive": 0, "OFPublique": 0, "Divers": 0, "famille": "Autre", "couleur": "#828282"}, {"nom": "nan", "adresse": "nan", "cp": "", "ville": "", "telephone": "nan", "site": "nan", "email": "nan", "categorie": "nan", "types_formation": "nan", "famille_metier": "nan", "diplomes": "nan", "modalites": "nan", "rncp": 0, "afdas": 0, "type": "Total / 57", "Artistique": 1, "Technique": 1, "AdminProd": 1, "SantePrevention": 1, "Enseignement": 1, "Audiovisuel": 1, "CentreRessources": 1, "Initiale": 1, "Continue": 1, "Stages": 1, "Diplomante": 1, "SansDiplome": 1, "Universite": 1, "ConservatoirePoleSup": 1, "Reseau": 1, "OFPrive": 1, "OFPublique": 0, "Divers": 1, "famille": "Institutionnel artistique", "couleur": "#F2C94C"}];

const map = L.map('map', { zoomControl: true }).setView([50.28, 2.80], 8);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19,
  attribution: '&copy; OpenStreetMap'
}).addTo(map);

const cluster = L.markerClusterGroup({
  showCoverageOnHover: false,
  spiderfyOnMaxZoom: true
});
cluster.addTo(map);

const markerIndex = new Map();
let geoDone = 0;
const geoPill = document.getElementById('geoPill');
const countPill = document.getElementById('countPill');

function norm(s) {
  return (s||"").toString().trim().toLowerCase()
    .normalize('NFD').replace(/\p{Diacritic}/gu,'')
    .replace(/’/g,"'");
}

function makePopup(d) {
  const chips = [];
  if (d.Initiale) chips.push('<span class="badge">Initiale</span>');
  if (d.Continue) chips.push('<span class="badge">Continue</span>');
  if (d.Stages) chips.push('<span class="badge">Stages</span>');
  if (d.Diplomante) chips.push('<span class="badge">Certif/Diplôme</span>');
  if (d.rncp) chips.push('<span class="badge">RNCP</span>');
  if (d.afdas) chips.push('<span class="badge">AFDAS</span>');

  const skills = [];
  if (d.Artistique) skills.push("Artistique");
  if (d.Technique) skills.push("Technique");
  if (d.AdminProd) skills.push("Admin/Prod");
  if (d.Audiovisuel) skills.push("Audiovisuel");
  if (d.Enseignement) skills.push("Pédagogie");
  if (d.SantePrevention) skills.push("Santé/Prévention");
  if (d.CentreRessources) skills.push("Ressources");

  const site = d.site ? `<a href="${d.site}" target="_blank" rel="noreferrer">Site</a>` : "";
  const mail = d.email ? `<a href="mailto:${d.email}">${d.email}</a>` : "";
  const tel = d.telephone ? `<div><b>Tél.</b> ${d.telephone}</div>` : "";
  const addr = (d.adresse || d.cp || d.ville) ? `<div><b>Adresse</b> ${[d.adresse, d.cp, d.ville].filter(Boolean).join(", ")}</div>` : "";

  return `
    <div style="min-width:280px; max-width:360px;">
      <div style="font-weight:800; font-size:14px; margin-bottom:6px;">${d.nom}</div>
      <div style="color:#445; font-size:12px; opacity:.9; margin-bottom:8px;">${d.categorie || d.famille}</div>
      <div>${chips.join(" ")}</div>
      <div style="margin-top:8px;">${addr}</div>
      ${tel}
      <div>${site} ${(site && mail) ? "•" : ""} ${mail}</div>
      <div style="margin-top:8px; font-size:12px;"><b>Compétences</b> : ${skills.join(" • ") || "—"}</div>
      ${d.famille_metier ? `<div style="margin-top:6px; font-size:12px;"><b>Métiers</b> : ${d.famille_metier}</div>` : ""}
      ${d.types_formation ? `<div style="margin-top:6px; font-size:12px;"><b>Offre</b> : ${d.types_formation}</div>` : ""}
    </div>
  `;
}

function icon(color) {
  return L.divIcon({
    className: "",
    html: `<div style="width:14px;height:14px;border-radius:999px;background:${color};border:2px solid rgba(255,255,255,.85); box-shadow:0 4px 10px rgba(0,0,0,.35)"></div>`,
    iconSize: [14,14],
    iconAnchor: [7,7]
  });
}

async function geocodeCommune(ville, cp) {
  const url = `https://geo.api.gouv.fr/communes?nom=${encodeURIComponent(ville)}&codePostal=${encodeURIComponent(cp)}&fields=nom,centre,codesPostaux,codeDepartement,codeRegion&format=json&geometry=centre`;
  const res = await fetch(url);
  if (!res.ok) throw new Error("geo api http " + res.status);
  const arr = await res.json();
  if (!Array.isArray(arr) || arr.length === 0) return null;

  const nv = norm(ville);
  let best = arr.find(x => norm(x.nom) === nv) || arr[0];
  if (!best.centre || !best.centre.coordinates) return null;
  const [lon, lat] = best.centre.coordinates;
  return [lat, lon];
}

function passesFilters(d, state) {
  if (state.q) {
    const hay = norm([d.nom, d.ville, d.categorie, d.types_formation, d.famille_metier].join(" "));
    if (!hay.includes(state.q)) return false;
  }

  const modKeys = ["Initiale","Continue","Stages","Diplomante","SansDiplome"];
  const activeMod = modKeys.filter(k => state.mod[k]);
  if (activeMod.length > 0) {
    if (!activeMod.some(k => !!d[k])) return false;
  }

  const skillKeys = ["Artistique","Technique","AdminProd","Audiovisuel","Enseignement","SantePrevention","CentreRessources"];
  const activeSk = skillKeys.filter(k => state.skill[k]);
  if (activeSk.length > 0) {
    if (!activeSk.some(k => !!d[k])) return false;
  }

  const typKeys = ["ConservatoirePoleSup","OFPrive","OFPublique","Universite","Reseau","Divers"];
  const activeTy = typKeys.filter(k => state.type[k]);
  if (activeTy.length > 0) {
    if (!activeTy.some(k => !!d[k])) return false;
  }
  return true;
}

function getState() {
  const q = norm(document.getElementById('q').value);
  const allF = {};
  document.querySelectorAll('input.f').forEach(cb => allF[cb.dataset.k] = cb.checked);

  const mod = {};
  ["Initiale","Continue","Stages","Diplomante","SansDiplome"].forEach(k => mod[k] = !!allF[k]);

  const skill = {};
  ["Artistique","Technique","AdminProd","Audiovisuel","Enseignement","SantePrevention","CentreRessources"].forEach(k => skill[k] = !!allF[k]);

  const type = {};
  document.querySelectorAll('input.t').forEach(cb => type[cb.dataset.k] = cb.checked);

  return { q, mod, skill, type };
}

function refresh() {
  const state = getState();
  let visible = 0;
  cluster.clearLayers();

  for (const d of DATA) {
    const m = markerIndex.get(d._id);
    if (!m) continue;
    if (passesFilters(d, state)) {
      cluster.addLayer(m);
      visible++;
    }
  }
  countPill.textContent = `${visible} structure${visible>1?'s':''}`;
}

function fitAll() {
  const layers = cluster.getLayers();
  if (!layers.length) return;
  const fg = L.featureGroup(layers);
  map.fitBounds(fg.getBounds().pad(0.2));
}

function resetAll() {
  document.getElementById('q').value = "";
  document.querySelectorAll('input.f, input.t').forEach(cb => cb.checked = true);
  refresh();
  fitAll();
}

document.getElementById('q').addEventListener('input', () => refresh());
document.querySelectorAll('input.f, input.t').forEach(cb => cb.addEventListener('change', () => refresh()));
document.getElementById('fitBtn').addEventListener('click', () => fitAll());
document.getElementById('resetBtn').addEventListener('click', () => resetAll());

async function main() {
  DATA.forEach((d, i) => d._id = i);

  const key = (d) => `${d.ville}|${d.cp}`;
  const groups = new Map();
  for (const d of DATA) {
    if (!d.ville || !d.cp) continue;
    const k = key(d);
    if (!groups.has(k)) groups.set(k, []);
    groups.get(k).push(d);
  }

  const total = groups.size;
  geoPill.textContent = `Géocodage 0/${total}`;

  for (const [k, items] of groups.entries()) {
    const [ville, cp] = k.split("|");
    let latlng = null;
    try {
      latlng = await geocodeCommune(ville, cp);
    } catch(e) {
      console.warn("Geocode failed", ville, cp, e);
    }
    if (!latlng) latlng = [50.28, 2.80];

    for (const d of items) {
      const m = L.marker(latlng, { icon: icon(d.couleur || "#828282") });
      m.bindPopup(makePopup(d), { maxWidth: 420 });
      markerIndex.set(d._id, m);
    }

    geoDone++;
    geoPill.textContent = `Géocodage ${geoDone}/${total}`;
  }

  refresh();
  fitAll();
  geoPill.textContent = "Géocodage OK";
}

main();
</script>
</body>
</html>
